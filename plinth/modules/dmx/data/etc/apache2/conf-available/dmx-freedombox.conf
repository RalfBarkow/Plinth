##
## On all sites, provide DMX on a default path: /systems.dmx.webclient/
##
## Requires the following Apache modules to be enabled:
##   mod_ssl
##   mod_rewrite
##   mod_proxy
##   mod_proxy_http
##   mod_proxy_wstunnel
##

AllowEncodedSlashes NoDecode

# This is the forwarding for the websockets. Always keep it the first rule.
# Do not forget to enable module proxy_wstunnel
RewriteEngine On
RewriteCond %{HTTP:Upgrade} =websocket
# the internal IP address
RewriteRule /_dmx/(.*)           wss://127.0.0.1:8766/$1 [NE,P,L]

<Location /_dmx>
    # This is the default rewrite for the webclient
    #RewriteRule ^/_dmx$ https://%{HTTP_HOST}/_dmx/systems.dmx.webclient/ [R,L]

    ProxyPass http://127.0.0.1:8765 nocanon
    ProxyPassReverse http://127.0.0.1:8765/
</Location>

# https://dreyeck.freedombox.rocks/_dmx
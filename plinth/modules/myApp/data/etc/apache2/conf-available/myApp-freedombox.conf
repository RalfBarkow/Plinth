##
## On all sites, provide DMX on a default path: /systems.dmx.webclient/
##
## Requires the following Apache modules to be enabled:
##   mod_ssl
##   mod_rewrite
##   mod_proxy
##   mod_proxy_http
##   mod_proxy_wstunnel
##

# Redirect /systems.dmx.webclient to /systems.dmx.webclient/
<Location ~ ^/systems.dmx.webclient$>
    <IfModule mod_rewrite.c>
        RewriteEngine On
        RewriteCond %{REQUEST_URI} ^/systems.dmx.webclient$
        RewriteRule .* /systems.dmx.webclient/ [R=301,L]
    </IfModule>
</Location>

 
<Location "/systems.dmx.webclient/">
    RewriteEngine on
    RewriteCond ${HTTP:Upgrade} websocket [NC]
    RewriteCond ${HTTP:Connection} upgrade [NC]
    RewriteRule .* "wss:/localhost:8081/$1" [NE,P,L]
    
    #ProxyPass|ProxyPassMatch can not have a path when defined in a location.
    ProxyPass https://localhost:8080/
    ProxyPassReverse https://localhost:8080/
</Location>

